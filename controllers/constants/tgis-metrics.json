{
  "data": [
    {
      "title": "Number of incoming requests",
      "type": "REQUEST_COUNT",
      "queries": [
        {
          "title": "Successful requests",
          "query": "sum(increase(tgi_request_success{namespace=${namespace}, pod=~'${model_name}-predictor-.*'}[${rate_interval}]))"
        },
        {
          "title": "Failed requests",
          "query": "sum(increase(tgi_request_failure{namespace=${namespace}, pod=~'${model_name}-predictor-.*'}[${rate_interval}]))"
        }
      ]
    },
    {
      "title": "Mean Model Latency",
      "type": "MEAN_LATENCY",
      "queries": [
        {
          "title": "Mean inference latency",
          "query": "sum by (pod) (rate(tgi_request_inference_duration_sum{namespace=${namespace}, pod=~'${model_name}-predictor-.*'}[${rate_interval}])) / sum by (pod) (rate(tgi_request_inference_duration_count{namespace=${namespace}, pod=~'${model_name}-predictor-.*'}[1m]))"
        },
        {
          "title": "Mean request latency",
          "query": "sum by (pod) (rate(tgi_request_duration_sum{namespace=${namespace}, pod=~'${model_name}-predictor-.*'}[${rate_interval}])) / sum by (pod) (rate(tgi_request_duration_count{namespace=${namespace}, pod=~'${model_name}-predictor-.*'}[1m]))"
        }
      ]
    },
    {
      "title": "CPU usage",
      "type": "CPU_USAGE",
      "queries": [
        {
          "title": "CPU usage",
          "query": "sum(node_namespace_pod_container:container_cpu_usage_seconds_total:sum_irate{namespace='${namespace}'}* on(namespace,pod) group_left(workload, workload_type) namespace_workload_pod:kube_pod_owner:relabel{namespace='${namespace}', workload=~'${model_name}-predictor-.*', workload_type=~'deployment'}) by (pod)"
        }
      ]
    },
    {
      "title": "Memory usage",
      "type": "MEMORY_USAGE",
      "queries": [
        {
          "title": "Memory usage",
          "query": "sum(container_memory_working_set_bytes{namespace='${namespace}', container!='', image!=''} * on(namespace,pod) group_left(workload, workload_type) namespace_workload_pod:kube_pod_owner:relabel{cluster='', namespace='${namespace}', workload=~'${model_name}-.*', workload_type=~'deployment'}) by (pod)"
        }
      ]
    }    
  ]
}
