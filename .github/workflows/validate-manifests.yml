name: Validation

on:
  pull_request:
  push:

jobs:
  validate-manifests:
    name: Validate Kustomize manifests
    timeout-minutes: 10
    concurrency:
      group: ${{ github.workflow }}-${{ github.ref }}-validate-manifests
      cancel-in-progress: true

    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v5

    - name: Install kustomize
      uses: imranismail/setup-kustomize@v2
      with:
        kustomize-version: '5.7.1'

    - name: Validate Kustomize manifests
      run: |
        set -euo pipefail
        ./hack/validate-manifests.sh
